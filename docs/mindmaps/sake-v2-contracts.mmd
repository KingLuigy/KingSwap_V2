Mind Map generated by NB MindMap plugin
> __version__=`1.1`,showJumps=`true`
---

# Sake v2

## SakeMaster
> collapsed=`true`


### \-\> SakeSwapFactory
> collapsed=`true`


#### \-\> SakeBar

#### SAKE\-WETH

## SakeMasterV2

## SakeToken
> collapsed=`true`


### is ERC20 token

### with checkpoints and delegation

## SakeMaker
> collapsed=`true`


### handles rewards for xSAKE holders

## SakeBar
> collapsed=`true`


### staking SAKE token
> collapsed=`true`


#### handles swapping to and from xSAKE

### is xSAKE token

## Governance contracts
> collapsed=`true`,leftSide=`true`


### GovernarAlpha

### Timelock
> collapsed=`true`


#### enque TXs \(on proposals\)

### SakeVoterProxy

### SakeVoterCalc

## SakeDrinker
> leftSide=`true`


### burns uniV2 tokens ???

## SakeLock
> collapsed=`true`


### is SakeLock token

### mints 1 SakeLock and \.\.\.
> collapsed=`true`


#### deposits 1 SakeLock witn SakeMaster

## SakeUni
> collapsed=`true`


### is NOT token

### it holds tokens
> collapsed=`true`


#### UNI token
> collapsed=`true`


##### collected on updatePool\(\_pid\)
> collapsed=`true`


###### pool\.uniStaking\.getReward\(\)

#### SAKE token

### two kinds of rewards to users
> collapsed=`true`


#### sakeReward
> collapsed=`true`


##### amount defined by contract
> collapsed=`true`


###### sakePerBlock

##### in SAKE token

#### uniReward
> collapsed=`true`


##### pool\.uniStaking\.getReward\(\)

##### amount defined by LP pool

##### in UNI token

### multiple LP pools
> collapsed=`true`


#### common UNI token for all pools
> collapsed=`true`


##### IERC20 public uniToken

#### own LP token for a pool

#### struct PoolInfo
> collapsed=`true`


##### IERC20 lpToken<br/>// staking LP token on uniswap<br/>IStakingRewards uniStaking<br/>uint256 accSakePerShare<br/>uint256 accUniPerShare<br/>\.\.\.
> align=`left`


### fees on withdrawal
> collapsed=`true`


#### in LP tokens
> collapsed=`true`


##### lpTokenFeeRatio

#### in UNI tokens
> collapsed=`true`


##### uniFeeRatio

### deposit\(\_pid, \_amount\)
> collapsed=`true`


#### user deposits LP token
> collapsed=`true`


##### to pool\.uniStake

##### for SAKE allocaltion

#### it transfers LP tokens from user to pool\.uniStaking

#### \_amount \- in LP tokens

### withdraw\(\_pid, \_amount\)
> collapsed=`true`


#### user withdraws LP tokens

#### \_amount \- in LP tokens

#### it transfers SAKE token
> collapsed=`true`


##### to the user

##### from address\(this\)

##### which are pending

#### it transfers UNI token
> collapsed=`true`


##### to the user

##### from address\(this\)

##### less fees
> collapsed=`true`


###### transferred to uniTokenFeeReceiver

#### it transfers LP token
> collapsed=`true`


##### to the user

##### from pool\.uniStaking

##### less fees
> collapsed=`true`


###### transferred to lpTokenFeeReceiver

## SakeUniV2
> collapsed=`true`


### is WULP token
> collapsed=`true`


#### i\.e\. Wrapped Uniswap LP token

### like SakeUni
> collapsed=`true`


#### it rewards/holds/transfers SAKE token
> collapsed=`true`


##### collected on updatePool\(\_pid\)
> collapsed=`true`


###### uniStaking\.getReward\(\)

##### collected from SakeMaster
> collapsed=`true`


###### on updatePool\(\)

#### it holds/transfers UNI token

#### it stakes LP token with uniStaking

#### it migrates LP token
> collapsed=`true`


##### if activated

### unlike SakeUni
> collapsed=`true`


#### is WULP token

#### it handles WULP
> collapsed=`true`


##### it mints WULP

##### it burns WULP

##### it stakes WULP
> collapsed=`true`


###### for user

###### with SakeMaster
> collapsed=`true`


####### that rewards SakeUniV2 with SAKE tokens

#### it handles single LP pool

#### if not already migrated
> collapsed=`true`


##### than only it allows LP token deposits

##### than only it withdraws LP token from uniStaking

#### owner only may migrate

### deposit\(uint256 \_amount\)
> collapsed=`true`


#### if not already migrated

#### user deposits LP token
> collapsed=`true`


#####  to SakeMaster

#####  for SAKE allocation

##### it transfers LP tokens from user to uniStaking

#### \_amount \- in LP tokens

#### in mints and stakes WULP
> collapsed=`true`


##### it stakes WULP with SakeMaster

##### it transfers minted WULP to SakeMaster

### withdraw\(\_amount\)
> collapsed=`true`


#### \_amount \- in LP tokens

#### it transfers SAKE
> collapsed=`true`


##### which are pending

##### to user

##### from itself
> collapsed=`true`


###### collecting rewarded from SakeMaster

#### if not yet migrated
> collapsed=`true`


##### it withdwraws LP tokens
> collapsed=`true`


###### from uniStaking

##### it withdraws WULP
> collapsed=`true`


###### from SakeMaster

#### it burns WULP
> collapsed=`true`


##### it transfers withdrawn WULP to nowhere

## STokenMaster
> collapsed=`true`


### new features
> collapsed=`true`


#### multiplierSToken

#### withdrawSwitch

#### feeRatio

#### burnSakeForPool

#### admin \(extra to owner\)

#### sToken
> collapsed=`true`


##### pool\.sToken

##### user\.amountStoken

### like SakeMaster but with SToken supported
> collapsed=`true`


#### struct UserInfo \{<br/>  // How many  tokens the user has provided,LP\+SToken\*multiplier<br/>  uint256 amount;<br/>  // How many S tokens the user has provided<br/>  uint256 amountStoken;<br/>  // How many LP tokens the user has provided<br/>  uint256 amountLPtoken;<br/>  uint256 rewardDebt;<br/>\}
> align=`left`


## SakeSwap contracts

### SakeSwapSlippageToken
> collapsed=`true`


#### is SST token
> collapsed=`true`


##### SakeSwap Slippage Token

#### newName: KingSwapSlippageToken

### SakeSwapERC20
> collapsed=`true`


#### is SLP
> collapsed=`true`


##### Sakeswap LP token

#### function permit
> collapsed=`true`


##### approve by signature

### SakeSwapPair
> collapsed=`true`


#### modified UniswapV2Pair

#### is is SakeSwapERC20

#### unlike UniswapV2Pair
> collapsed=`true`


##### new functions
> collapsed=`true`


###### // public/external writes to the storage<br/>function dealSlippageWithIn\(path, amountIn, to, ifmint\)<br/>function dealSlippageWithOut\(path, amountIn, to, ifmint\)<br/><br/>// public/external view<br/>function getVirtualPrice\(\)<br/>function getTokenMarketPrice\(token\)<br/>function getAmountOutMarket\(token, amountIn\)<br/>function getAmountInMarket\(token, amountOut\)<br/>function getAmountOutPool\(token, amountIn\)<br/>function getAmountInPool\(token, amountOut\)<br/>function getAmountOutFinal\(token, amountIn\)<br/>function getAmountInFinal\(token, amountOut\)<br/><br/>// internal<br/>function \_updateVirtualPrice<br/>function \_getToken0MarketPrice<br/>function \_getAmountOut<br/>function \_getAmountIn<br/>function getAmountOutReal<br/>function getAmountInReal<br/>
> align=`left`


##### new storage vars
> collapsed=`true`


###### uint224 private virtualPrice;<br/>uint32 private lastPriceTime;

###### SakeSwapSlippageToken public stoken

##### modified functions
> collapsed=`true`


###### function mint\(address to\)
> collapsed=`true`


####### address migrator = ISakeSwapFactory\(factory\)\.migrator\(\)

###### function initialize
> collapsed=`true`


####### stoken = new SakeSwapSlippageToken\(0\);

###### function swap
> collapsed=`true`


####### \_updateVirtualPrice\(\_reserve0, \_reserve1\);

### SakeSwapFactory

### SakeSwapRouter

## Tools contracts
> collapsed=`true`,leftSide=`true`


### SakeSwapMigrator
> collapsed=`true`


####  Migrates from SUSHISWAP/UNISWAP to SAKESWAP

#### function migrateUniswapWithPermit

#### migrateSushiSwapWithPermit

#### function migrateUniswap

#### uniFactory = IFactory\(0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f\);<br/>uniRouter = IRouter\(0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D\);
> collapsed=`true`


##### UniswapV2Factory<br/>Uniswap V2: Router 2

### SakeSwapBatchTrade

## Migrator
> collapsed=`true`


### Migrate LP tokens from Uniswap to SakeSwap
> collapsed=`true`


#### from Uni/Sushi factory

#### to SakeSwapFactory

### instances
> collapsed=`true`


#### Migrate\-uniswap

#### Migrate\-sushiswap

### function migrate\(ISakeSwapPair orig\)
> collapsed=`true`


#### only Chief may run

#### notBeforeBlock

#### \`orig\` Pair from Uni/Sushi factory

#### creates SakeSwapPair
> collapsed=`true`


##### on SakeSwapFactory

##### if not exists

#### burns \`orig\` LP tokens
> collapsed=`true`


##### transfers LP tokens
> collapsed=`true`


###### from Chief

###### to \`orig\` Pair

##### \.\.\. and burns

#### mints LP tokens on SakeSwapPair
